services:
  db:
    ports:
      - "5432:5432"
  
  web:
    command: >
      bash -lc "uvicorn src.dashboard.app:app --host 0.0.0.0 --port 8000 --reload \
      --reload-dir /app/src \
      --reload-include '*.py' --reload-include '*.html' --reload-include '*.css' --reload-include '*.js' \
      --log-level debug"
    environment:
      DASHBOARD_DEBUG: "1"

  agent:
    # Enable code reload using uvicorn factory; pass GPU index via env
    command: bash -lc "uvicorn agent.server:create_app --host 0.0.0.0 --port 7070 --reload --factory"
