{% extends "layouts/project_base.html" %}
{% import "components/macros.html" as ui %}
{% block title %}Models Â· Unified Dashboard{% endblock %}
{% block crumb %}Models{% endblock %}
{% block project_content %}
<section>
  <h2 class="muted">Models Registry</h2>
  {% call ui.card('Add Model') %}
    <form id="create-model" class="grid grid-cols-1 gap-4 sm:grid-cols-2">
      <label class="field"><span>Label</span><input class="block w-full rounded-md border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-800 dark:border-slate-700" name="label" placeholder="Label" required /></label>
      <label class="field"><span>HF checkpoint id</span><input class="block w-full rounded-md border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-800 dark:border-slate-700" name="hf_checkpoint_id" placeholder="hf checkpoint id" required /></label>
      <label class="field"><span>Notes</span><input class="block w-full rounded-md border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-800 dark:border-slate-700" name="notes" placeholder="Notes" /></label>
      <label class="field"><span>Default pretrained</span><input type="checkbox" name="default_pretrained" checked /></label>
      <div><button class="btn btn-primary" type="submit">Add</button></div>
    </form>
  {% endcall %}
  {% call ui.card('Models') %}
    <table class="table" id="mdlTable"><thead><tr><th>Label</th><th>Checkpoint</th><th>Pretrained</th><th></th></tr></thead><tbody></tbody></table>
  {% endcall %}
</section>
<script>
async function fetchModels(){
  const res = await fetch('/api/v1/projects/{{ project_id }}/models');
  const data = await res.json();
  const tbody = document.querySelector('#mdlTable tbody');
  tbody.innerHTML='';
  data.forEach(m=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${m.label}</td><td><code>${m.hf_checkpoint_id}</code></td><td>${m.default_pretrained?"Yes":"No"}</td><td><button class="btn btn-danger" onclick=\"delModel('${m.id}')\">Delete</button></td>`;
    tbody.appendChild(tr);
  });
}
async function delModel(id){
  await fetch(`/api/v1/projects/models/${id}`, {method:'DELETE'});
  fetchModels();
}
document.getElementById('create-model').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = {
    label: fd.get('label'),
    hf_checkpoint_id: fd.get('hf_checkpoint_id'),
    notes: fd.get('notes') || null,
    default_pretrained: fd.get('default_pretrained') === 'on'
  };
  const r = await fetch('/api/v1/projects/{{ project_id }}/models', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
  if(r.ok){ e.target.reset(); toast('Model added'); fetchModels(); }
});
fetchModels();
</script>
{% endblock %}
