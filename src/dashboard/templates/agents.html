{% extends "base.html" %}
{% import "components/macros.html" as ui %}
{% block title %}Agents Â· Unified Dashboard{% endblock %}
{% block content %}
  {% call ui.card('Agents') %}
    <table class="table" id="agentsTable"><thead><tr><th>Name</th><th>ID</th><th>Created</th></tr></thead><tbody></tbody></table>
    <div id="gpu-list"></div>
  {% endcall %}

<script>
async function fetchAgents(){
  const res = await fetch('/api/v1/agents');
  const data = await res.json();
  const tbody = document.querySelector('#agentsTable tbody');
  tbody.innerHTML='';
  const gpuList = document.getElementById('gpu-list');
  gpuList.innerHTML='';
  for(const a of data){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${a.name}</td><td>${a.id}</td><td>${new Date(a.created_at).toLocaleString()}</td>`;
    tbody.appendChild(tr);
    const gRes = await fetch(`/api/v1/agents/${a.id}/gpus`);
    const gpus = await gRes.json();
    const div = document.createElement('div');
    div.innerHTML = `<h4>GPUs for ${a.name}</h4>`;
    const table = document.createElement('table'); table.className = 'table';
    table.innerHTML = '<thead><tr><th>Index</th><th>Name</th><th>Mem</th><th>Allocated</th></tr></thead>';
    const tb = document.createElement('tbody');
    gpus.forEach(g=>{
      const tr2 = document.createElement('tr');
      tr2.innerHTML = `<td>${g.index}</td><td>${g.name||''}</td><td>${g.total_mem_mb||''} MB</td><td>${g.is_allocated?'Yes':'No'}</td>`;
      tb.appendChild(tr2);
    });
    table.appendChild(tb);
    div.appendChild(table);
    gpuList.appendChild(div);
  }
}
fetchAgents();
</script>
{% endblock %}
