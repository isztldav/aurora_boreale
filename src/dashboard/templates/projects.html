{% extends "base.html" %}
{% import "components/macros.html" as ui %}
{% block title %}Projects Â· Unified Dashboard{% endblock %}
{% block content %}
  {% call ui.card('Create Project') %}
    <form id="create-project-form" class="grid grid-cols-1 gap-4 sm:grid-cols-2">
      <label class="field"><span>Name</span><input class="block w-full rounded-md border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-800 dark:border-slate-700" name="name" placeholder="Name" required /></label>
      <label class="field"><span>Description</span><input class="block w-full rounded-md border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-800 dark:border-slate-700" name="description" placeholder="Description" /></label>
      <div><button class="btn btn-primary" type="submit">Create</button></div>
    </form>
  {% endcall %}

  {% call ui.card('Projects') %}
    <table class="table" id="projTable">
      <thead><tr><th>Name</th><th>Description</th><th>Created</th></tr></thead>
      <tbody></tbody>
    </table>
  {% endcall %}

<script>
async function fetchProjects(){
  const res = await fetch('/api/v1/projects');
  const data = await res.json();
  const tbody = document.querySelector('#projTable tbody');
  tbody.innerHTML='';
  data.forEach(p=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td><a href="/web/projects/${p.id}">${p.name}</a></td><td>${p.description||''}</td><td>${new Date(p.created_at).toLocaleString()}</td>`;
    tbody.appendChild(tr);
  })
}
document.getElementById('create-project-form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = {name: fd.get('name'), description: fd.get('description')};
  const resp = await fetch('/api/v1/projects', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
  if(resp.ok){ toast('Project created'); e.target.reset(); fetchProjects(); }
});
fetchProjects();
</script>
{% endblock %}
